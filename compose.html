<!DOCTYPE html>
<html lang="zh">

<head>
    <!-- META -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="我的我">
    <meta name="author" content="Ying Phigow">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1">
    <style type="text/css">
        @charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none
        !important;}ng\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}
    </style>
    <!-- PAGE TITLE -->
    <title>编纂中……</title>
    <!-- BOOTSTRAP CSS -->
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <!-- ALL GOOGLE FONTS -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
    <!-- FONT AWESOME CSS -->
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/linear-fonts.css">
    <!-- PAGE CSS -->
    <link rel="stylesheet" href="assets/css/book-page.css">
    <script src="https://code.jquery.com/jquery-git.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.0.272/jspdf.debug.js"></script>
</head>
<body ng-app="wxbook">
    <ui-view name="main">
    <!---->
        <div class="wrapper preview" ui-view="preview">
            <div id="page" class="A5-1 finalized" ng-class="{error: vm.book.error,editable: vm.book.editable,finalized: vm.book.finalized}" ng-switch="vm.stateParams.section">
                <div class="pages-container" ng-switch-when="cover" auto-resize="" style="transform: scale(0.644643);">
                    <ul class="pages" id="page_lists">
                        <!--封面页-->
                        <li class="page cover swipeout" book="vm.book" parse-emoji=".author, .title">
                            <cover book="book" pic="book.cover.pic" size="560" editable="book.editable &amp;&amp; book.cover.editable"
                            class="loaded" style="background-image:url(/assets/images/page/cover.jpg);">
                                <ng-transclude>
                                    <!---->
                                </ng-transclude>
                            </cover>

                                        <div class="swipeout-actions-right">
                                            <a href="#" class="swipeout-delete">
                                                Delete
                                            </a>
                                        </div>
                        </li>
                        <!--扉页-->
                        <li class="page first-page" parse-emoji=".author">
                            <div class="author">
                                <span id="para_author">{author}</span><!-- Parameter_Author -->
                                <span>
                                    &middot; 作品
                                </span>
                            </div>
                            <div class="from" id="para_from"><!-- Parameter_StartTime -->
                                2016.07
                            </div>
                            <div class="to" id="para_to"><!-- Parameter_EndTime -->
                                2016.12
                            </div>
                        </li>
                        <!--版权页-->
                        <li class="page authorization" book="vm.book" parse-emoji="">
                            <p>
                                微信书当前版本编目数据
                            </p>
                            <p>
                                伴你成长的岁月 / [我的我]<span id="para_author">{author}</span><!-- Parameter_Author --> 著;
                            </p>
                            <p>
                                我的我&middot;微信书,wodemy.com, 2017.3
                            </p>
                            <p>
                                XINSHU-XXXXX-290450
                            </p>
                            <p>
                                I.①伴你成长的岁月...; II. ① <span id="para_author">{author}</span><!-- Parameter_Author --> ...; III. ①文学随笔，语录-微信书-中国-现代; IV. ①NO.290450
                            </p>
                            <p>
                                我的我&middot;微信书荣誉出版 (2017)290450号
                            </p>
                            <p>
                                著作权归原作者所有
                            </p>
                            <p>
                                All rights reserved under Xinshu and Author <span id="para_author">{author}</span><!-- Parameter_Author --> . This book may not
                                be reproduced or used in any form or by any means without permission of
                                the author.
                            </p>
                            <p>
                                <b>
                                    伴你成长的岁月
                                </b>
                            </p>
                            <p>
                                [我的我] <span id="para_author">{author}</span><!-- Parameter_Author --> 著
                            </p>
                            <table>
                                <tbody>
                                    <tr>
                                        <td>
                                            技　　术
                                        </td>
                                        <td>
                                            我的我
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            发　　行
                                        </td>
                                        <td>
                                            我的我
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            经　　销
                                        </td>
                                        <td>
                                            我的我
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            责任编辑
                                        </td>
                                        <td>
                                            我的我小编
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            装帧设计
                                        </td>
                                        <td>
                                            我的我设计
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            内文制作
                                        </td>
                                        <td>
                                            <span id="para_author">{author}</span><!-- Parameter_Author -->
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            插　　图
                                        </td>
                                        <td>
                                            <span id="para_author">{author}</span><!-- Parameter_Author -->
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            开　　本
                                        </td>
                                        <td>
                                            870mm &times; 1092mm 1/32
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            字　　数
                                        </td>
                                        <td>
                                            很多
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            版　　次
                                        </td>
                                        <td>
                                            2017年第一版，唯一版
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            定　　价
                                        </td>
                                        <td>
                                            无价
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            书　　号
                                        </td>
                                        <td>
                                            290450
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <p>
                                本书版权归<span id="para_author">{author}</span><!-- Parameter_Author -->所有，我的我提供代印刷服务，未经<span id="para_author">{author}</span><!-- Parameter_Author -->许可不得转载、复制、翻印，一切因版权、著作权、肖像权、名誉权、姓名权而引起的法律纠纷由本书制作者承担。
                            </p>
                        </li>
                        <!--感谢-->
                        <li class="page acknowledgement collapse ng-hide" ng-class="{collapse: !_.isString(book.acknowledgement)}"
                        ng-show="book.auth === 'edit' &amp;&amp; !book.finalized || book.acknowledgement"
                        ng-switch="!book.finalized &amp;&amp; book.auth === 'edit'" book="vm.book">
                            <!---->
                            <!---->
                            <div ng-switch-when="false">
                                <p class="content" parse-emoji="">
                                </p>
                            </div>
                            <!---->
                            <div class="title" ng-click="book.acknowledgement = ''">
                                <i class="material-icons">
                                    add
                                </i>
                                增加致谢
                            </div>
                        </li>
                        <!--序-->
                        <li class="page preface" ng-class="{collapse: !_.isString(book.preface)}"
                        ng-show="book.auth === 'edit' &amp;&amp; !book.finalized || book.preface"
                        ng-switch="!book.finalized &amp;&amp; book.auth === 'edit'" book="vm.book">
                            <!---->
                            <!---->
                            <div class="content-container" ng-switch-when="false" parse-emoji="">
                                <p class="content" style="margin-bottom:1.5em">
                                    天一，我们亲爱的宝贝： 时光真快啊， 你已经11周岁了，爸爸妈妈也已经到了不惑之年，爷爷奶奶已过花甲之年，姥姥也已经70岁古稀之年喽。我们家人在北京生活这么多年，有过艰辛，有过困境，但是看见你一天天快乐健康地长大，这是我们最大的幸福！
                                    天一，你性格慢慢沉稳了，像你爸爸但是比爸爸更活泼开朗，喜欢听相声，模仿得也有模有样的。你学习双簧管进步很大，在丽帆乐团也开始慢慢适应和队员们合作演出。
                                    跆拳道已经蓝带了，最近也开始学习滑雪，在体育局注册了滑雪运动员，希望有机会可以参加滑雪比赛。 儿子，你这些爱好，妈妈都支持你，希望你不固步自封，不做井底之蛙，多学多看，见多识广，能结交到各个领域的朋友，无论长大遇到什么样的困难都能积极地面对，想办法解决问题，永远阳光快乐地生活！
                                    天一，爸爸妈妈爱你！
                                </p>
                                <p class="content" style="text-align:right">
                                    鹤爸玲妈 2016年12月31日
                                </p>
                            </div>
                            <!---->
                            <div class="title" ng-click="book.preface = ''">
                                <i class="material-icons">
                                    add
                                </i>
                                增加序言
                            </div>
                        </li>
                        <!--正文-->
                        
                    </ul>

    <a href="pay.html" target="new" class="swipe-out">提交</a>
                </div>
            </div>
        </div>
    </ui-view>
</body>

<script type="text/javascript" src="/assets/js/jquery.min.js"></script>
<script type="text/javascript" src="/assets/js/framework7.min.js"></script>
<script src="/assets/js/jquery-1.10.1.min.js" type="text/javascript" ></script>
<script src="/assets/js/underscore.js" type="text/javascript" ></script>
<script type="text/template" id="comment">
    <p>
        <span><%=authorName%>：</span><%=content%>
    </p>
</script>
<script type="text/template" id="page_template">
    <li class="page content row" book="vm.book" page-data="page" parse-emoji=".book-title" ng-repeat="page in vm.book.pages | limitTo: vm.limit track by $index">
        <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
            <text class="date" id="para_date"><%=date%></text><!--Parameter_Date-->
            <text class="time" id="para_time" fill="#fff"><%=time%></text><!--Parameter_Time-->
        </div>
        <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9">
            <div id="para_img"><%=img%></div><!--Parameter_Images-->
            <div id="para_content"><%=content%></div><!--Parameter_Content-->
        </div>
        <footer>
            <hr>
            <div class="pagination"><%=no%></div>
            <div class="book-title">天堂向左，深圳往右</div>
            <div class="date">2015/11</div>
        </footer>
    </li>
</script>

<script type="text/template" id="images">
    <p>
        <img class="list-img" src=<%=img%> style="width:100%">
    </p>
</script>
<script type="text/template" id="double_images">
    <p class="row">
        <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
            <img class="list-img" src=<%=imgA%> style="width:100%">
        </span>
        <span class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
            <img class="list-img" src=<%=imgB%> style="width:100%">
        </span>
    </p>
</script>
<script type="text/template" id="list_template">
<li>
    <div class="po-avt-wrap">
       // <!--img class="po-avt data-avt" src="images/0.jpg"-->
    </div>
    <div class="po-hd">
        <p class="po-name"><span class="data-name"><%=authorName%></span></p>
        <div class="post">
            <p><%=content%></p>
            <p><%=img%></p>                
            </p>
        </div>
        <p class="time"><%=time%></p><img class="c-icon" src="wechat/images/c.png">
    </div>
    <div class="r"></div>
    <div class="cmt-wrap">
        <div class="like"><img src="wechat/images/l.png"><%+likes%></div>
        <div class="cmt-list">
            <%=comments%>
        </div>
    </div>
</li>
</script>
<script type="text/javascript">
function timeStamp2date (time){
        var datetime = new Date();
        datetime.setTime(time);
        var year = datetime.getFullYear();
        var month = datetime.getMonth() + 1;
        var date = datetime.getDate();
        return year + "-" + month + "-" + date;
};
function timeStamp2time (time){
        var datetime = new Date();
        datetime.setTime(time);
        var hour = datetime.getHours();
        var minute = datetime.getMinutes();
        var second = datetime.getSeconds();
        return hour+":"+minute+":"+second;
};
function timeStamp2String (time){
        var datetime = new Date();
         datetime.setTime(time);
         var year = datetime.getFullYear();
         var month = datetime.getMonth() + 1;
         var date = datetime.getDate();
         var hour = datetime.getHours();
         var minute = datetime.getMinutes();
         var second = datetime.getSeconds();
         var mseconds = datetime.getMilliseconds();
         return year + "-" + month + "-" + date+" "+hour+":"+minute+":"+second;
};
jQuery(document).ready(function() {
        var template = _.template($('#list_template').html());
        $.ajax({
                type:       "GET",
                url:        '/assets/json/1490247048.json',
                dataType:   "json",
                success: function(data) {
                    console.log(data);
                    options="";
                    var page=_.template($('#page_template').html());
                    var pages="";
                    for(var i = 0; i < data.length; i++){
                        /*赞
                        var likes="";
                        for(var n=0;n < data[i].likes.length; n++){
                            likes += data[i].likes[n].userName + " ";
                        }
                        */
                        /*评论
                        var comment= _.template($('#comment').html());
                        var comments="";                       
                        for(var m=0;m < data[i].comments.length; m++){
                            comments += comment(
                                {
                                    authorName:     data[i].comments[m].authorName,
                                    content:        data[i].comments[m].content
                                });
                        }
                        */
                        $('#para_author*').html(data[i].authorName);  
                        $('#para_from').html(timeStamp2String(data[i].timestamp*1000));  
                        $('#para_to').html(timeStamp2String(data[0].timestamp*1000)); 
                        var Simage=_.template($('#images').html());
                        var Dimage=_.template($('#double_images').html());
                        var images="";
                        if(data[i].mediaList.length == 1) {
                            imgsrc = (data[i].mediaList[0].indexOf("qpic.cn/mm")>0?"https://weixinshu.com/images/fetch?url=":"")+data[i].mediaList[0];
                            images = Simage(
                            {
                                img:        imgsrc
                            });
                        }
                        else{
                            for(var img=0;img < data[i].mediaList.length; img+=2){
                                imgsrcA = (data[i].mediaList[img].indexOf("qpic.cn/mm")>0?"https://weixinshu.com/images/fetch?url=":"")+data[i].mediaList[img];
                                if(img + 2 > data[i].mediaList.length){
                                    imgsrcB="";
                                }
                                else{
                                    imgsrcB =  (data[i].mediaList[img+1].indexOf("qpic.cn/mm")>0?"https://weixinshu.com/images/fetch?url=":"")+data[i].mediaList[img+1]
                                };
                                //console.log(images);
                                images += Dimage(
                                    {
                                        imgA:       imgsrcA,
                                        imgB:       imgsrcB
                                    });
                            }
                        };
                        $('#para_date').html(timeStamp2String(data[i].timestamp*1000).split(" ")[0]);
                        $('#para_time').html(timeStamp2String(data[i].timestamp*1000).split(" ")[1]);
                        $('#para_img').html(images);                        
                        $('#para_content').html(data[i].content);
                        /*整体*/
                        pages += page(
                        {
                            date:       timeStamp2date(data[i].timestamp*1000),
                            time:       timeStamp2time(data[i].timestamp*1000),
                            img:        images,
                            content:    data[i].content,
                            no:         i+1
                        })
                        /*
                        options += template(
                        {
                            authorName: data[i].authorName,
                            time:       timeStamp2String(data[i].timestamp*1000),
                            img:        images,
                            //img:        data[i].mediaList[0].indexOf("http://mmsns.qpic.cn/mmsns/")>0?"https://weixinshu.com/images/fetch?url=":""+data[i].mediaList[0],
                            content:    data[i].content,
                            likes:      likes,
                            comments:   comments
                        })
                        */
                    }
                    $("#page_lists").append(pages);
                },
                error: function(data) {
                    console.log(data.length);
                }
            }
        )
});

</script>
<script type="text/javascript">
    
    //可以自定义配置参数
var myApp = new Framework7({
    //materialPageLoadDelay:0,   //延迟（在毫秒）之前的动画加载页。可以增加一点来提高性能
    //materialRipple:'true'       //启用/禁用特有的触摸纹波效应
});

// 我们需要使用自定义DOM类库，让我们将它保存到$$变量：
var $$ = Framework7.$;

</script>

    <script type="text/javascript">
    var topdf =function(){
        var pdf = new jsPDF('p','mm','a5');
        pdf.internal.scaleFactor = 1;
        var options = {
             pagesplit: true
        };

        //$('.pdf-wrapper')
        pdf.addHTML(document.body,options,function() {
            pdf.save('web1111.pdf');
        });
    }
    </script>
</html>